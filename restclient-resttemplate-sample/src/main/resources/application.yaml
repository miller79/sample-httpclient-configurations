spring:
  # OAuth2 (client_credentials) example using a token provider (issuer-uri) and
  # a service account registration. Replace environment variables with real
  # values in your deployment or use a spring profile file for local testing.
  security:
    oauth2:
      client:
        provider:
          serviceAccount:
            # URL of the OpenID Connect issuer that provides tokens (example default)
            issuer-uri: ${ISSUER_URI:https://accounts.google.com}
        registration:
          serviceAccount:
            # Client credentials (recommended: supply via env vars or secret manager)
            client-id: ${CLIENT_ID}
            client-secret: ${CLIENT_SECRET}
            authorization-grant-type: client_credentials

  # Blocking HTTP client configuration
  http:
    client:
      # Select the Spring-provided HttpComponents (Apache HttpClient 5) factory
      factory: http-components
      # Common timeout examples (uncomment and tune based on your API SLAs):
      # read-timeout: 3m     # Maximum time to wait for a response after request is sent
      # connect-timeout: 3m  # Time to establish TCP connection to the server

miller79:
  apache:
    # ‚≠ê BEST PRACTICE: Connection lifecycle settings prevent stale connections
    # These values work for 95% of production applications
    
    max-idle-time: 3m
    # üí° 3-4 minutes is optimal for most apps
    # - Short enough to clean up idle connections regularly
    # - Long enough to benefit from connection pooling
    # - Shorter than typical server/LB timeouts (5-10 min)
    
    max-life-time: 30m
    # üí° 5-30 minutes forces connection rotation
    # - 5-10 min: Dynamic environments (Kubernetes, frequent deploys)
    # - 15-30 min: Stable infrastructure
    # - Ensures DNS changes and LB updates are picked up
    
    # üîë With the above settings, TCP keep-alive is NOT necessary!
    # Only enable keep-alive for special cases:
    # - Long-lived persistent connections (WebSockets, SSE)
    # - Aggressive firewall environments that close connections < 3 min
    
    # Uncomment only if needed:
    # max-connections: 50           # Based on peak concurrent requests
    # so-keep-alive: true           # Only for special cases (see above)
    # tcp-keep-idle: 30s            # Time before first keep-alive probe
    # tcp-keep-interval: 10s        # Time between probes
    # tcp-keep-count: 3             # Failed probes before connection is dead
