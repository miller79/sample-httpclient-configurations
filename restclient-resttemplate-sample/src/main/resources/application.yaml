spring:
  # OAuth2 (client_credentials) example using a token provider (issuer-uri) and
  # a service account registration. Replace environment variables with real
  # values in your deployment or use a spring profile file for local testing.
  security:
    oauth2:
      client:
        provider:
          serviceAccount:
            # URL of the OpenID Connect issuer that provides tokens (example default)
            issuer-uri: ${ISSUER_URI:https://accounts.google.com}
        registration:
          serviceAccount:
            # Client credentials (recommended: supply via env vars or secret manager)
            client-id: ${CLIENT_ID}
            client-secret: ${CLIENT_SECRET}
            authorization-grant-type: client_credentials

  # Blocking HTTP client configuration
  http:
    client:
      # Select the Spring-provided HttpComponents (Apache HttpClient 5) factory
      factory: http-components
      # Common timeout examples (uncomment and tune based on your API SLAs):
      # read-timeout: 16s     # Maximum time to wait for a response after request is sent
      # connect-timeout: 17s  # Time to establish TCP connection to the server
      #
      # ‚ö†Ô∏è WARNING: Without these timeouts, requests can wait INDEFINITELY!
      # This can exhaust thread pools and cause cascading failures.
      # Recommended: 5-15s for most APIs (measure your P99 latency + buffer)


## Example Apache HttpClient tuning (commented) -------------------------------
# üéØ Purpose: These settings control connection pooling, lifecycle, and TCP
#            keep-alive for blocking HTTP clients (RestClient/RestTemplate).
#
# ‚ö†Ô∏è If you don't configure these: Connections live forever, idle connections
#    accumulate, and stale connections cause "connection reset" errors.
#
# To enable: Copy into a profile (e.g., `application-local.yaml`), remove
#           the leading `# `, and adjust values for your environment.
#
# üìñ Learn more: See README.md "Understanding Timeouts & Defaults" section
#
# miller79:
#   apache:
#     # Max total connections across all routes. Default: 64
#     # üí° Too low ‚Üí requests queue, timeouts increase
#     # üí° Too high ‚Üí memory waste, overwhelm downstream services
#     # üìè Size based on peak concurrent requests (start with 50-100)
#     # max-connections: 64
#
#     # Evict connections idle for longer than this. Default: 60s
#     # üí° Shorter values free up resources faster
#     # üí° Should be < server idle timeout to prevent stale connections
#     # üìè Common: 30-60s (shorter if behind load balancer)
#     # max-idle-time: 60s
#
#     # Maximum lifetime before connection is closed and removed. Default: 60s
#     # üí° Prevents stale connections through load balancers/DNS changes
#     # üí° MUST be < load balancer timeout (AWS ALB=60s, Nginx=75s)
#     # üìè Common: 30-50s for LB environments, 60s for direct connections
#     # max-life-time: 60s
#
#     # Enable socket-level TCP keep-alive. Default: true
#     # üí° Detects broken connections before they're used
#     # üí° Essential for long-lived connection pools
#     # so-keep-alive: true
#
#     # Idle time before the first TCP keep-alive probe. Default: 30s
#     # üí° Start probing after this much inactivity
#     # üìè Common: 30-60s (balance between detection speed & network overhead)
#     # tcp-keep-idle: 30s
#
#     # Interval between TCP keep-alive probes. Default: 5s
#     # üí° How often to retry if first probe fails
#     # üìè Common: 5-10s
#     # tcp-keep-interval: 5s
#
#     # Number of failed probes before connection is dead. Default: 3
#     # üí° Total detection time = tcp-keep-idle + (count √ó interval)
#     # üìè Example: 30s + (3 √ó 5s) = 45s to detect dead connection
#     # tcp-keep-count: 3
#
#     # Response timeout applied on the client side. Default: 5s
#     # üí° CRITICAL: Set based on your API's P99 latency + buffer
#     # üí° Too low ‚Üí valid requests fail; Too high ‚Üí slow services block threads
#     # üìè Fast APIs: 1-5s | Normal APIs: 5-15s | Slow APIs: 15-60s
#     # response-timeout: 5s
## -----------------------------------------------------------------------------